<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë§¤ì¥ ì°¾ê¸° í˜ì´ì§€</title>
    <link rel="stylesheet" href="/src/common/modern-reset.css" />
    <link rel="stylesheet" href="/src/Ediya-component/map/find-store-page.css" />

    <!-- Naver Map API -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=l8j4hl32y3"></script>
  </head>
  <body>
    <h1 class="sr-only">ë§¤ì¥ ì°¾ê¸° í˜ì´ì§€</h1>

    <div class="component-box">
      <div class="tab-wrapper">
        <form id="search-form">
          <div class="tab-menu-wrapper">
            <div class="label">
              <div class="tab-menu">
                <input type="radio" name="store-filter" id="store-name" value="store-name" checked />
                <label for="store-name">ì í¬ëª…</label>
              </div>
              <br />
              <div class="tab-menu">
                <input type="radio" name="store-filter" id="store-address" value="store-address" />
                <label for="store-address">ì£¼ì†Œ</label>
              </div>
            </div>
            <p class="keyboard-guide sr-only">â† â†’ í‚¤ë¡œ í•„í„°ë¥¼ ë³€ê²½í•˜ì„¸ìš”</p>
            <div class="search-input">
              <input type="text" placeholder="ê²€ìƒ‰ì–´" class="label" />
              <button type="submit">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <ellipse cx="11.7584" cy="11.6272" rx="5.51836" ry="5.38696" stroke="#24388D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M15.5965 15.6533L17.76 17.7598" stroke="#24388D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
            </div>
          </div>
        </form>
        <ul class="search-result-list">
          <li>
            <div class="search-result">
              <figure>
                <img src="/src/assets/ediay-find-store/ediyacoffee-img.svg" alt="" />
                <figcaption>
                  <p class="store-title"><strong>ê¸¸ìŒ ë‰´íƒ€ìš´ì </strong></p>
                  <p class="store-detail">ì„œìš¸ ì„±ë¶êµ¬ ê¸¸ìŒë¡œ 74 (ê¸¸ìŒë™, ê¸¸ìŒ ì—ìŠ¤ì—ì´ì¹˜ë¹Œ)</p>
                </figcaption>
              </figure>
            </div>
          </li>
          <li>
            <div class="search-result">
              <figure>
                <img src="/src/assets/ediay-find-store/ediyacoffee-img.svg" alt="" />
                <figcaption>
                  <p class="store-title"><strong>ê¸¸ìŒ ì¤‘ì•™ì </strong></p>
                  <p class="store-detail">ì„œìš¸ ì„±ë¶êµ¬ ë„ë´‰ë¡œ 11 (ê¸¸ìŒë™, ì‚¼ì£¼ë¹Œë”©)</p>
                </figcaption>
              </figure>
            </div>
          </li>
        </ul>
      </div>
      <div class="map" id="map"></div>
    </div>

    <script>
      let map;
      let markers = [];

      function initMap() {
        console.log('ğŸ—º ì§€ë„ ì´ˆê¸°í™” ì¤‘...');
        if (!window.naver || !naver.maps) {
          console.error('âŒ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨');
          return;
        }

        map = new naver.maps.Map('map', {
          center: new naver.maps.LatLng(37.5665, 126.978),
          zoom: 13,
        });

        console.log('âœ… ì§€ë„ ìƒì„± ì™„ë£Œ');
      }

      // ê¸°ì¡´ ë§ˆì»¤ ì œê±° í•¨ìˆ˜
      function clearMarkers() {
        markers.forEach((marker) => marker.setMap(null));
        markers = [];
      }

      // ë§ˆì»¤ ìƒì„± ë° ì§€ë„ í‘œì‹œ í•¨ìˆ˜
      function addMarker(lat, lng, title, address) {
        const position = new naver.maps.LatLng(lat, lng);

        const marker = new naver.maps.Marker({
          map: map,
          position: position,
        });

        const infowindow = new naver.maps.InfoWindow({
          content: `<div style="padding:10px; min-width:150px;">
                      <strong>${title}</strong><br />
                      <span>${address}</span>
                    </div>`,
        });

        naver.maps.Event.addListener(marker, 'click', () => {
          infowindow.open(map, marker);
        });

        markers.push(marker);

        // ë§ˆì»¤ ìœ„ì¹˜ë¡œ ì§€ë„ ì¤‘ì‹¬ ì´ë™
        map.setCenter(position);
        map.setZoom(15);
      }

      document.addEventListener('DOMContentLoaded', () => {
        initMap();

        const searchForm = document.getElementById('search-form');
        const searchInput = searchForm.querySelector('input[type="text"]');
        const filterRadios = searchForm.elements['store-filter'];

        // ë”ë¯¸ ë§¤ì¥ ë°ì´í„° (ì‹¤ì œ APIë‚˜ DBë¡œ êµì²´ ê°€ëŠ¥)
        const stores = [
          {
            name: 'ê¸¸ìŒ ë‰´íƒ€ìš´ì ',
            address: 'ì„œìš¸ ì„±ë¶êµ¬ ê¸¸ìŒë¡œ 74 (ê¸¸ìŒë™, ê¸¸ìŒ ì—ìŠ¤ì—ì´ì¹˜ë¹Œ)',
            lat: 37.6135,
            lng: 127.0248,
          },
          {
            name: 'ê¸¸ìŒ ì¤‘ì•™ì ',
            address: 'ì„œìš¸ ì„±ë¶êµ¬ ë„ë´‰ë¡œ 11 (ê¸¸ìŒë™, ì‚¼ì£¼ë¹Œë”©)',
            lat: 37.615,
            lng: 127.023,
          },
        ];

        searchForm.addEventListener('submit', (e) => {
          e.preventDefault();

          const keyword = searchInput.value.trim();
          if (!keyword) return;

          // í•„í„°ê°’ í™•ì¸ (store-name or store-address)
          const filter = Array.from(filterRadios).find((r) => r.checked).value;

          // ê¸°ì¡´ ë§ˆì»¤ ì‚­ì œ
          clearMarkers();

          // ê²€ìƒ‰ ê²°ê³¼ í•„í„°ë§
          const filteredStores = stores.filter((store) => {
            if (filter === 'store-name') {
              return store.name.includes(keyword);
            } else if (filter === 'store-address') {
              return store.address.includes(keyword);
            }
            return false;
          });

          if (filteredStores.length === 0) {
            alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

          // ê²€ìƒ‰ ê²°ê³¼ ë§ˆì»¤ ì°ê¸°
          filteredStores.forEach((store) => {
            addMarker(store.lat, store.lng, store.name, store.address);
          });
        });
      });
    </script>
  </body>
</html>
